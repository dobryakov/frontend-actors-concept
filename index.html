<!doctype html>
<html lang="ru-RU">
<head>
<script type="text/javascript" src="m/underscore.js"></script>
<script type="text/javascript" src="m/jquery.js"></script>
<script type="text/javascript" src="m/backbone.js"></script>
<script type="text/javascript" src="m/backbone.marionette.js"></script>
<script type="text/javascript" src="m/backbone.wreqr.js"></script>
</head>
<body>

<script type="text/javascript">

var MyApp = Marionette.Application.extend({
  initialize: function(options) {
    console.log(options.container);
  }
});

var myApp = new MyApp({container: '#app'});

myApp.on("before:start", function(options){
  options.moreData = "Yo dawg, I heard you like options so I put some options in your options!"
});

myApp.on("start", function(options){
  if (Backbone.history){
    Backbone.history.start();
  }
});

var options = {
  something: "some value",
  another: "#some-selector",
  channelName: 'appChannel'
};

myApp.start(options);

var RootView = Marionette.LayoutView.extend({
  el: 'body'
});

myApp.rootView = new RootView();

myApp.addRegions({
  someRegion: "#some-div",
  anotherRegion: "#another-div"
});

var globalCh = Backbone.Wreqr.radio.channel('appChannel');

globalCh.vent.on("minutePassed", function(someData){
  console.log("Received ", someData);
});

//window.setInterval(function() {
//  globalCh.vent.trigger("minutePassed", 'message ' + new Date() + '.');
//}, 1000 * 5);

var timeModel = Backbone.Model.extend({
  defaults: {
    value: 0
  },
  initialize: function() {
    
  },
});

var timeEntity = new timeModel;

globalCh.vent.on("timeEntity:setValue", function(value){
  timeEntity.set({value: value});
});

window.setInterval(function() {
  globalCh.vent.trigger("timeEntity:setValue", new Date());
}, 1000 * 5);

var timeView = Backbone.View.extend({

  initialize: function() {
    this.listenTo(this.model, "change", this.render);
  },

  render: function() {
    $('#time').html(this.model.get('value'));
  }

});

var timeEntityView = new timeView({
  model: timeEntity
});

</script>

<div id="app"></div>
<div id="some-div"></div>
<div id="another-div"></div>

<div id="time"></div>

</body>
</html>
